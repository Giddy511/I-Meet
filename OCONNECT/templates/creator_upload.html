{% extends 'base.html' %}

{% block title %}Creator Upload{% endblock %}

{% block content %}
<div class="space-y-6">
  <!-- Upload Form -->
  <div class="max-w-md mx-auto bg-white p-6 rounded shadow">
    <h2 class="text-lg font-medium mb-4">Upload Content</h2>
    <form method="post" enctype="multipart/form-data" class="space-y-3">
      <input class="w-full border rounded px-3 py-2" type="text" name="Title" placeholder="Title">
      <textarea class="w-full border rounded px-3 py-2" name="Caption" placeholder="Caption"></textarea>
      <input class="w-full" type="file" name="file" accept="image/*,video/*" required>
      <div class="flex justify-end">
        <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" type="submit">Upload</button>
      </div>
    </form>
  </div>

  <!-- Creator's Posts -->
  <div>
    <h2 class="text-xl font-semibold mb-4 text-white">Your Posts</h2>
    {% if media %}
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        {% for m in media %}
        <div class="rounded overflow-hidden bg-gray-900 border border-gray-700">
          <a href="{{ url_for('media_detail', media_id=m['id']) }}">
            <div class="media-frame w-full mx-auto overflow-hidden bg-black" style="aspect-ratio:1/1; max-width:1080px;">
              {% set ext = m['filename'].rsplit('.',1)[-1].lower() if m['filename'] and '.' in m['filename'] else '' %}
              {% if ext in ['mp4','webm','mov','ogg'] %}
                <video src="{{ url_for('uploads', filename=m['filename']) }}" class="object-cover w-full h-full autoplay-video" muted playsinline loop preload="metadata"></video>
              {% else %}
                <img src="{{ url_for('uploads', filename=m['filename']) }}" alt="{{ m['title'] }}" class="object-cover w-full h-full">
              {% endif %}
            </div>
          </a>
          <div class="p-3">
            <h3 class="font-semibold text-white"><a href="{{ url_for('media_detail', media_id=m['id']) }}">{{ m['title'] }}</a></h3>
            <p class="text-sm text-gray-400">{{ m['caption'] }}</p>
            <div class="mt-2 text-sm text-gray-500">Comments: {{ m['comments_count'] }} &nbsp; Reactions: {{ m['reactions_count'] }} {% if m['rating_avg'] %} &nbsp; Avg rating: {{ m['rating_avg'] }}{% endif %}</div>
            <div class="mt-2">
              <button class="share-btn bg-gray-700 text-white px-3 py-1 rounded text-sm" data-media-id="{{ m['id'] }}" data-media-url="{{ url_for('media_detail', media_id=m['id'], _external=True) }}">Share</button>
              <span class="text-sm text-gray-400 share-count" data-media-id="{{ m['id'] }}">Shared {{ m['share_count'] }}</span>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-gray-400">No posts yet. Upload your first one above!</p>
    {% endif %}
  </div>
</div>
{% endblock %}
