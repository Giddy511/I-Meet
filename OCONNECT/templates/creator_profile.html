{% extends 'base.html' %}

{% block title %}{{ username }} - Posts{% endblock %}

{% block content %}
<div class="p-6 rounded shadow" data-admin-theme-light="bg-white text-black" data-admin-theme-dark="bg-black text-white">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-xl font-semibold" data-admin-theme-light="text-black" data-admin-theme-dark="text-white">Posts by {{ username }}</h2>
    <div>
      {% if session.get('logged_in') and session.get('role') == 'Consumer' and session.get('id') != creator_id %}
        <form method="post" action="{{ url_for('follow_creator', creator_id=creator_id) }}">
          <button class="px-3 py-1 rounded bg-blue-500 text-white text-sm">{% if is_following %}Unfollow{% else %}Follow{% endif %}</button>
        </form>
      {% endif %}
    </div>
  </div>
  {% if media %}
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
      {% for m in media %}
      <div class="rounded overflow-hidden bg-white">
        <a href="{{ url_for('media_detail', media_id=m['id']) }}">
          <div class="media-frame w-full mx-auto overflow-hidden bg-black" style="aspect-ratio:1/1; max-width:1080px;">
            {% set ext = m['filename'].rsplit('.',1)[-1].lower() if m['filename'] and '.' in m['filename'] else '' %}
            {% if ext in ['mp4','webm','mov','ogg'] %}
              <video src="{{ url_for('uploads', filename=m['filename']) }}" class="object-cover w-full h-full autoplay-video" muted playsinline loop preload="metadata"></video>
            {% else %}
              <img src="{{ url_for('uploads', filename=m['filename']) }}" alt="{{ m['title'] }}" class="object-cover w-full h-full">
            {% endif %}
          </div>
        </a>
        <div class="p-3">
          <h3 class="font-semibold"><a href="{{ url_for('media_detail', media_id=m['id']) }}">{{ m['title'] }}</a></h3>
          <p class="text-sm text-gray-600">{{ m['caption'] }}</p>
          <div class="mt-2 text-sm text-gray-700">Comments: {{ m['comments_count'] }} &nbsp; Reactions: {{ m['reactions_count'] }} {% if m['rating_avg'] %} &nbsp; Avg rating: {{ m['rating_avg'] }}{% endif %}</div>
          <div class="mt-2">
            <button class="share-btn bg-gray-700 text-white px-3 py-1 rounded text-sm" data-media-id="{{ m['id'] }}" data-media-url="{{ url_for('media_detail', media_id=m['id'], _external=True) }}">Share</button>
            <span class="text-sm text-gray-400 share-count" data-media-id="{{ m['id'] }}">Shared {{ m['share_count'] }}</span>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p>No posts yet.</p>
  {% endif %}
</div>
{% endblock %}
